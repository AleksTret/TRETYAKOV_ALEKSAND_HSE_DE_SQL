# Домашнее задание 4

**Выполнил - Третьяков Александр Юрьевич**

## Упражение 9

### Задание

В таблице «Студенты» (`students`) есть текстовый атрибут `name`, на который наложено ограничение `NOT NULL`. Как вы думаете, что будет, если при вводе новой
строки в эту таблицу дать атрибуту `name` в качестве значения пустую строку?
Например:
```sql
INSERT INTO students ( record_book, name, doc_ser, doc_num )
VALUES ( 12300, '', 0402, 543281 );
```
Наверное, проектируя эту таблицу, мы хотели бы все же, чтобы пустые строки
в качестве значения атрибута `name` не проходили в базу данных? Какое решение вы можете предложить? Видимо, нужно добавить ограничение `CHECK` для
столбца `name`. Если вы еще не изучили команду `ALTER TABLE`, то удалите таблицу `students` и создайте ее заново с учетом нового ограничения, а если вы уже
познакомились с командой `ALTER TABLE`, то сделайте так:
```sql
ALTER TABLE students ADD CHECK ( name <> '' );
```
Добавив ограничение, попробуйте теперь вставить в таблицу `students` строку
(`row`), в которой значение атрибута name было бы пустой строкой (`string`).
Давайте продолжим эксперименты и предложим в качестве значения атрибута
name строку, содержащую сначала один пробел, а потом — два пробела.
```sql
INSERT INTO students VALUES ( 12346, ' ', 0406, 112233 );
INSERT INTO students VALUES ( 12347, ' ', 0407, 112234 );
```
Для того чтобы «увидеть» эти пробелы в выборке, сделаем так:
```sql
SELECT *, length( name ) FROM students;
```
Оказывается, эти невидимые значения имеют ненулевую длину. Что делать,
чтобы не допустить таких значений-невидимок? Один из способов: возложить
проверку таких ситуаций на прикладную программу. А что можно сделать на
уровне определения таблицы `students`? Какое ограничение нужно предложить? В разделе 9.4 документации «Строковые функции и операторы» есть
функция `trim`. Попробуйте воспользоваться ею. Если вы еще не изучили команду `ALTER TABLE`, то удалите таблицу `students` и создайте ее заново с учетом
нового ограничения, а если уже познакомились с ней, то сделайте так:
```sql
ALTER TABLE students ADD CHECK (...);
```
Есть ли подобные слабые места в таблице «Успеваемость» (`progress`)?

### Решение

Проверим наличие ограничений в таблице `students`

<img src="./assets/ex_9/2025-11-03 104329.jpg" width="1000" >

Вставка записи которая содержит `name` равное пустой строке будет выполнена, потому что это значение не `NULL`

```sql
INSERT INTO students ( record_book, name, doc_ser, doc_num )
VALUES ( 12300, '', 0402, 543281 );
```

<img src="./assets/ex_9/2025-11-03 104610.jpg" width="700" >

Добавим ограничение на пустые строки в таблицу

Если попробовать сразу после `insert` сделанного ранее добавить ограничение, то возникнет ошибка, означающая что в таблице уже есть строки которые содержат `name` = `''`

<img src="./assets/ex_9/2025-11-03 105330.jpg" width="700" >

Удалим строку, добавим ограничение

<img src="./assets/ex_9/2025-11-03 105512.jpg" width="700" >

Выполнил вставку с `name` = `''`, `name` = `' '` и `name` = `'  '`. Проверим результат

<img src="./assets/ex_9/2025-11-03 105936.jpg" width="800" >

Что бы не допустить значений "невидимок" можем воспользоваться следующим ограничением

```sql
ALTER TABLE students ADD CHECK (trim(name) <> '');
```

Проведем тестирование невалидных случаем

<img src="./assets/ex_9/2025-11-03 110741.jpg" width="800" >

И валидных

<img src="./assets/ex_9/2025-11-03 110925.jpg" width="800" >

Таблица `progress` также уязвима для вставки пустых строк или строк состоящих только из пробелов. Нужно добавить аналогичные ограничения:

```sql
-- Для subject
ALTER TABLE progress ADD CHECK (trim(subject) <> '');

-- Для acad_year  
ALTER TABLE progress ADD CHECK (trim(acad_year) <> '');
```