# Домашнее задание 10

**Выполнил - Третьяков Александр Юрьевич**

## Упражение 17

### Задание
Представление `Create_paths` позволяет отобразить только
четыре уровня иерархии. Модифицируйте его так, чтобы оно могло
работать с пятью уровнями иерархии. 

### Решение

Удалим старое представление
```sql
DROP VIEW IF EXISTS Create_paths;
```

Создаем новое представление с 5 уровнями

```sql
CREATE VIEW Create_paths (level1, level2, level3, level4, level5) AS
SELECT 
    O1.emp AS e1, 
    O2.emp AS e2, 
    O3.emp AS e3, 
    O4.emp AS e4,
    O5.emp AS e5
FROM Personnel_org_chart AS O1
LEFT OUTER JOIN Personnel_org_chart AS O2 ON O1.emp = O2.boss
LEFT OUTER JOIN Personnel_org_chart AS O3 ON O2.emp = O3.boss 
LEFT OUTER JOIN Personnel_org_chart AS O4 ON O3.emp = O4.boss
LEFT OUTER JOIN Personnel_org_chart AS O5 ON O4.emp = O5.boss
WHERE O1.emp = 'Иван';
```

<img src="./assets/ex_17/2025-11-24 205236.jpg" width="700">

Добавим тестовые данные для проверки
```sql
INSERT INTO Personnel VALUES (11, 'Стажер', 'ул. Тестовая', '2000-01-01');

-- Добавим его в иерархию как подчиненного Николаю (код 8)
INSERT INTO Org_chart (job_title, emp_nbr, boss_emp_nbr, salary) 
VALUES ('Стажер', 11, 8, 200.00);
```

<img src="./assets/ex_17/2025-11-24 205302.jpg" width="700">

Проверим обновленное представление
```sql
SELECT * FROM Create_paths;
```

<img src="./assets/ex_17/2025-11-24 205324.jpg" width="700">

Проверим целостность дерева
```sql
SELECT tree_test();
```

<img src="./assets/ex_17/2025-11-24 205442.jpg" width="400">