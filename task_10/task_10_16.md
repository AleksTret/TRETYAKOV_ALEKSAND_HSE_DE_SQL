# Домашнее задание 10

**Выполнил - Третьяков Александр Юрьевич**

## Упражение 16

### Задание
Если в таблице «Организационная структура» осталось мало
данных, то дополните ее данными и выполните удаление элемента
иерархии и продвижение дочерних элементов на один уровень вверх
(т. е. к «бабушке»).
```sql
SELECT * FROM delete_and_promote_subtree( 5 );
```
Аналогично работе с функцией `up_tree_traversal()` используйте подзапрос для получения кода работника по его имени.
После удаления элемента иерархии посмотрите, что стало
с организационной структурой, с помощью двух представлений
`Personnel_org_chart` и `Create_paths`.
### Решение
Проверим текущую структуру
```sql
SELECT * FROM Personnel_org_chart ORDER BY emp_nbr;
```
<img src="./assets/ex_16/2025-11-24 203743.jpg" width="700">

Выполним удаление с продвижением для работника с кодом 5 (Ирина - Ведущий программист)
```sql
SELECT delete_and_promote_subtree(5);
```
Проверим изменения в структуре
```sql
SELECT * FROM Personnel_org_chart ORDER BY emp_nbr;
```
```sql
SELECT * FROM Create_paths;
```

<img src="./assets/ex_16/2025-11-24 204213.jpg" width="700">

Удалена Ирина (код 5) - Ведущий программист

Ее подчиненные перешли к ее начальнику:
Андрей (код 7) и Николай (код 8) теперь подчиняются напрямую Антону (код 3)

Это и есть "продвижение к бабушке" :))) - подчиненные перешли к начальнику своего бывшего начальника

Выполним удаление с продвижением по имени работника "Антон" (код 3)
```sql
SELECT delete_and_promote_subtree((SELECT emp_nbr FROM Personnel WHERE emp_name = 'Антон'));
```
Проверим изменения
```sql
SELECT * FROM Personnel_org_chart ORDER BY emp_nbr;
```
```sql
SELECT * FROM Create_paths;
```
<img src="./assets/ex_16/2025-11-24 204414.jpg" width="700">

Проверим целостность дерева
```sql
SELECT tree_test();
```

<img src="./assets/ex_16/2025-11-24 204452.jpg" width="300">