# Домашнее задание 5

**Выполнил - Третьяков Александр Юрьевич**

## Упражение 23

### Задание
Предположим, что департамент развития нашей авиакомпании задался вопросом: каким будет общее число различных маршрутов, которые теоретически
можно проложить между всеми городами?
Если в каком-то городе имеется более одного аэропорта, то это учитывать не
будем, т. е. маршрутом будем считать путь между городами, а не между аэропортами. Здесь мы используем соединение таблицы с самой собой на основе
неравенства значений атрибутов.
```sql
SELECT count( * )
    FROM ( SELECT DISTINCT city FROM airports ) AS a1
    JOIN ( SELECT DISTINCT city FROM airports ) AS a2
        ON a1.city <> a2.city;

count
-------
10100
(1 строка)
```
**Задание**. Перепишите этот запрос с общим табличным выражением.

### Решение

Исходная логика:
- Берем все уникальные города из `airports`
- Делаем декартово произведение таблицы на саму себя
- Фильтруем пары, где города разные (`a1.city <> a2.city`)
- Считаем количество таких пар

```sql
WITH cities AS (
    SELECT DISTINCT city 
    FROM airports
)
SELECT count(*) 
FROM cities a1
JOIN cities a2 ON a1.city <> a2.city;
```

<img src="./assets/ex_23/2025-11-10 210313.jpg" width="700">